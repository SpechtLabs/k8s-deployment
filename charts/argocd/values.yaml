argo-cd:
  fullnameOverride: argocd
  dex:
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
        selector:
          scope: k8s-av0-de
  redis:
    serviceAccount:
      create: true
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
        selector:
          scope: k8s-av0-de

  repoServer:
    image:
      repository: "ghcr.io/av0de/argocd-custom-container"
      imagePullPolicy: "Always"
    volumes:
      - name: helm-secrets
        secret:
          secretName: helm-secrets
    volumeMounts:
      - mountPath: /helm-secrets/
        name: helm-secrets
    env:
      - name: XDG_CONFIG_HOME
        value: /home/argocd/.config
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
        selector:
          scope: k8s-av0-de

  server:
    image:
      repository: "ghcr.io/av0de/argocd-custom-container"
      imagePullPolicy: "Always"
    certificate:
      enabled: false
      domain: argocd.av0.de
    config:
      url: https://argocd.av0.de
      kustomize.buildOptions: "--enable-alpha-plugins --enable-helm"
      dex.config: |
        connectors:
          - type: github
            id: github
            name: GitHub
            config:
              clientID: $dex.oauth.github.clientID
              clientSecret: $dex.oauth.github.clientSecret
              orgs:
                - name: av0de
    ingress:
      enabled: true
      https: true
      pathType: ImplementationSpecific
      hosts:
        - argocd.av0.de
      tls:
        - secretName: argocd-secret
          hosts:
            - argocd.av0.de

      annotations:
        "cert-manager.io/cluster-issuer": "letsencrypt-prod"
        "kubernetes.io/ingress.class": nginx
        "nginx.ingress.kubernetes.io/backend-protocol": HTTPS
        "nginx.ingress.kubernetes.io/ssl-passthrough": "true"
    rbacConfig:
      policy.default: role:readonly
      policy.csv: |
        p, role:org-admin, *, *, *, allow
        p, role:viewer, *, get, *, allow

        g, av0de, role:viewer
        g, av0de:admin, role:org-admin
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
        selector:
          scope: k8s-av0-de

  controller:
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
        selector:
          scope: k8s-av0-de

  configs:
    repositories:
      bitnami:
        name: bitnami
        type: helm
        url: https://charts.bitnami.com/bitnami
      grafana:
        name: grafana
        type: helm
        url: https://grafana.github.io/helm-charts
      argo:
        name: Argo
        type: helm
        url: https://argoproj.github.io/argo-helm
      jetstack:
        name: jetstack
        type: helm
        url: https://charts.jetstack.io
      ingress-nginx:
        name: ingress-nginx
        type: helm
        url: https://kubernetes.github.io/ingress-nginx
      deliveryhero:
        name: deliveryhero
        type: helm
        url: https://charts.deliveryhero.io/
      prometheus:
        name: prometheus
        type: helm
        url: https://prometheus-community.github.io/helm-charts