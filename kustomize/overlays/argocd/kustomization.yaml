apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: argocd

resources:
  - ../../bases/argocd/

generators:
  - ./secret-generator.yaml

patches:
  - target:
      kind: Deployment
      namespace: argocd
      name: argocd-server
    path: argo-server-sidecar.patch.yaml

  - target:
      kind: Deployment
      namespace: argocd
      name: argocd-repo-server
    path: repo-server-sidecar.patch.yaml

  - target:
      kind: StatefulSet
      namespace: argocd
      name: argocd-application-controller
    path: app-controller.patch.yaml

patchesStrategicMerge:
  - role-repo-server.patch.yaml