fullnameOverride: mimir

metaMonitoring:
  serviceMonitor:
    enabled: true

  grafanaAgent:
    enabled: true
    installOperator: false

continuous_test:
  enabled: true

minio:
  enabled: false

query_scheduler:
  enabled: false
  installOperator: false

global:
  extraEnv:
    - name: JAEGER_AGENT_HOST
      value: "tempo-distributor.observability.svc.cluster.local"
    - name: JAEGER_AGENT_PORT
      value: "6831"
    - name: JAEGER_SAMPLER_TYPE
      value: "const"

mimir:
  structuredConfig:
    common:
      storage:
        backend: s3
        s3:
          endpoint: minio.minio.svc.cluster.local:9000
          region: us-east
          access_key_id: mimir
          secret_access_key: supersecure123
          insecure: true

    memberlist:
      abort_if_cluster_join_fails: true

    ingester:
      ring:
        unregister_on_shutdown: true
        #replication_factor: 3

    limits:
      # Adjust max query parallelism to 16x sharding, without sharding we can run 14d queries fully in parallel.
      # With sharding we can further shard each day another 16 times. 14 days * 16 shards = 224 subqueries.
      max_query_parallelism: 224
      max_global_series_per_user: 0
      ingestion_rate: 0
      # Delete from storage metrics data older than 1 year.
      compactor_blocks_retention_period: 1y
      # Allow ingestion of out-of-order samples up to 5 minutes since the latest received sample for the series.
      out_of_order_time_window: 5m

    blocks_storage:
      s3:
        bucket_name: mimir-tsdb

    alertmanager_storage:
      s3:
        bucket_name: mimir-alert

    ruler_storage:
      s3:
        bucket_name: mimir-ruler

nginx:
  replicas: 1
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 3

ingester:
  replicas: 3

  persistentVolume:
    size: 50Gi


  # TODO: Deploy nodes to different zones
  zoneAwareReplication:
    enabled: false
    topologyKey: 'kubernetes.io/hostname'
    zones:
      - name: fsn1-a
        nodeSelector:
          topology.kubernetes.io/region: fsn1
      - name: fsn1-b
        nodeSelector:
          topology.kubernetes.io/region: fsn1
      - name: fsn1-c
        nodeSelector:
          topology.kubernetes.io/region: fsn1

    topologySpreadConstraints:
      maxSkew: 3
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: ScheduleAnyway

store_gateway:
  replicas: 3

  persistentVolume:
    size: 10Gi

  zoneAwareReplication:
    enabled: false
    topologyKey: 'kubernetes.io/hostname'
    zones:
      - name: fsn1-a
        nodeSelector:
          topology.kubernetes.io/region: fsn1
      - name: fsn1-b
        nodeSelector:
          topology.kubernetes.io/region: fsn1
      - name: fsn1-c
        nodeSelector:
          topology.kubernetes.io/region: fsn1

    topologySpreadConstraints:
      maxSkew: 3
      topologyKey: kubernetes.io/hostname
      whenUnsatisfiable: ScheduleAnyway

alertmanager:
  persistentVolume:
    enabled: true
  replicas: 2
  statefulSet:
    enabled: true

compactor:
  persistentVolume:
    size: 20Gi

distributor:
  replicas: 3

overrides_exporter:
  replicas: 1

querier:
  replicas: 1

query_frontend:
  replicas: 1

ruler:
  replicas: 2

chunks-cache:
  enabled: false
  replicas: 2

index-cache:
  enabled: false
  replicas: 3

metadata-cache:
  enabled: false

results-cache:
  enabled: false
  replicas: 2